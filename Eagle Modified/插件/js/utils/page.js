console.log("page.js Start");var hiddenElements,CAPTURE_DELAY=500,floatingElementInterval=null,playingVideos=[];function onMessage(e,t,n){return"scrollPage"!==e.msg||(getPositions(n),!0)}function max(e){return Math.max.apply(Math,e.filter(function(e){return e}))}function getPositions(e){var t,n=CAPTURE_DELAY,i=document.querySelector("#eagle-resize-tool .resizers");i?t={x:i.offsetLeft,y:i.offsetTop,width:i.clientWidth,height:i.clientHeight}:window.scrollTo(0,0);var o=getMainScrollElement();t&&(o=document.documentElement,t.y=t.y+jQuery("body").offset().top);var l,d=document.body;o&&o!==document.documentElement?o.scrollTop:l=window.scrollY;var r,c,h=[document.documentElement.clientWidth,d?d.scrollWidth:0,document.documentElement.scrollWidth,d?d.offsetWidth:0,document.documentElement.offsetWidth],g=[o&&o.clientHeight||0,o&&o.scrollHeight||0],u=max(h),s=max(g),m=window.innerWidth,a=window.innerHeight,f=[],w=a-(a>200?200:0),p=m,y=s;if(g=o&&o!==document.documentElement?[o&&o.clientHeight||0,o&&o.scrollHeight||0]:[document.documentElement.clientHeight,d?d.scrollHeight:0,document.documentElement.scrollHeight,d?d.offsetHeight:0,document.documentElement.offsetHeight],u<=p+1&&(u=p),u>window.innerWidth&&(u=window.innerWidth),(!t||t.height>a)&&document.documentElement.classList.add("eagle-scrolling"),document.documentElement.classList.add("hide-eagle-cropper"),document.documentElement.classList.add("eagle-capturing"),t)if(t.y>l&&t.y+t.height<l+a)f.unshift([0,l]),n=1;else for(y=t.y+t.height;y>t.y-w;)f.unshift([0,y]),y-=w;else for(;y>-w;){for(r=0;r<u;)f.unshift([r,y]),r+=p;y-=w}c=f.length;var H=jQuery("head title",window.parent.document),E=H.text();function x(){H.text(E),document.documentElement.classList.remove("eagle-scrolling"),document.documentElement.classList.remove("eagle-capturing"),o&&o!==document.documentElement?o.scrollTop=l:window.scrollTo(0,l),0==$("#save-to-eagle-dialog").length&&$("body").append('<div id="save-to-eagle-dialog"></div>'),clearTimeout(floatingElementInterval),$("[eagle-scrolling-hidden]").removeAttr("eagle-scrolling-hidden"),playingVideos.forEach(function(e){e.play()}),playingVideos=[],$("#save-to-eagle-dialog").show()}Date.now();!function i(){if(!f.length)return e&&e(),void x();var l=f.shift(),d=(l[0],l[1]);if(t){if(!o||o===document.documentElement){var r=jQuery(window).scrollTop();r<t.y&&r+a>t.y+t.height&&t.height<a||window.scrollTo(0,d)}}else o&&o!==document.documentElement?o.scrollTop=d:window.scrollTo(0,d);(t&&t.height>a||!t)&&(f.length===c-1?hiddenElements=getAnnoyingElements():(hiddenElements=getFloatingElements(),floatingElementInterval=setTimeout(function(){getFloatingElements().forEach(function(e){$(e).attr("eagle-scrolling-hidden","true")})},200)),hiddenElements.forEach(function(e){$(e).attr("eagle-scrolling-hidden","true")})),Array.from(document.querySelectorAll("video")).filter(function(e){return!e.paused}).forEach(function(e){playingVideos.push(e),e.pause()}),playingVideos=[...new Set(playingVideos)];var h=(c-f.length)/c,g={msg:"capture",x:window.scrollX,complete:h,windowWidth:m,totalWidth:u,totalHeight:s,rect:t,numOfScrollPostions:c-f.length,pixelRatio:window.devicePixelRatio};logger.info(`[page] capture(${c-f.length}/${c})`),H.text(`${parseInt(100*h)}% | ${E}`),o&&o!==document.documentElement?g.y=Math.round(o.scrollTop):g.y=Math.round(window.scrollY),window.setTimeout(function(){var e=window.setTimeout(x,2e3);Date.now(),window.clearTimeout(e),chrome.runtime.sendMessage(g,function(e){e&&(o&&f&&Math.abs(parseInt(o.scrollTop)-g.y)>2?setTimeout(function(){i()},1e3):i())})},n)}()}function getZIndex(e){if(e==document)return 0;var t=document.defaultView.getComputedStyle(e).getPropertyValue("z-index");return isNaN(t)?getZIndex(e.parentNode):t}function isElementVisible(e){try{if("HTML"===e.nodeName||"BODY"===e.nodeName)return!0;const i=getComputedStyle(e);if("none"===i.display)return!1;if("visible"!==i.visibility)return!1;if(0===i.opacity)return!1;if(e.offsetWidth+e.offsetHeight+e.getBoundingClientRect().height+e.getBoundingClientRect().width===0)return!1;var t={center:{x:e.getBoundingClientRect().left+e.offsetWidth/2,y:e.getBoundingClientRect().top+e.offsetHeight/2},"top-left":{x:e.getBoundingClientRect().left,y:e.getBoundingClientRect().top},"top-right":{x:e.getBoundingClientRect().right,y:e.getBoundingClientRect().top},"bottom-left":{x:e.getBoundingClientRect().left,y:e.getBoundingClientRect().bottom},"bottom-right":{x:e.getBoundingClientRect().right,y:e.getBoundingClientRect().bottom}};for(index in t){var n=t[index];if(n.x<0)return!1;if(n.x>(document.documentElement.clientWidth||window.innerWidth))return!1;if(n.y<0)return!1;if(n.y>(document.documentElement.clientHeight||window.innerHeight))return!1;let i=document.elementFromPoint(n.x,n.y);if(null!==i)do{if(i===e)return!0}while(i=i.parentNode)}return!1}catch(e){return!0}}function getMainScrollElement(){for(var e=[],t=document.getElementsByTagName("*"),n=0;n<t.length;n++){var i=t[n];i.scrollHeight>i.clientHeight&&e.push({elem:i,scrollHeight:i.scrollHeight,clientHeight:i.clientHeight})}return e=e.filter(function(e){if(e.clientHeight>window.innerHeight)return!1;if(e.elem&&"TEXTAREA"===e.elem.nodeName)return!1;if(!isElementVisible(e.elem))return!1;var t=getComputedStyle(e.elem).overflow;return t.includes("auto")||t.includes("scroll")}),"hidden"!==getComputedStyle(document.documentElement).overflowY&&e.unshift({scrollHeight:document.documentElement.scrollHeight,clientHeight:document.documentElement.clientHeight,elem:document.documentElement}),(e=e.sort(function(e,t){if(e.clientHeight===t.clientHeight&&e.scrollHeight!==t.scrollHeight){var n=parseInt(getZIndex(e.elem)),i=parseInt(getZIndex(t.elem));return n<i?1:n>i?-1:0===n&&0===i?e.scrollHeight<t.scrollHeight?1:-1:0}return e.scrollHeight<t.scrollHeight?1:e.scrollHeight>t.scrollHeight?-1:0})).length>0?e[0].elem:document.documentElement}function getFloatingElements(){for(var e=document.getElementsByTagName("*"),t=[],n=0;n<e.length;n++){var i=e[n],o=getComputedStyle(i),l=o.position;"0"!==o.width&&"0"!==o.height&&"0"!==o.opacity&&"none"!==o.display&&"hidden"!==o.visibility&&(l.includes("fixed")||l.includes("sticky"))&&t.push(i)}var d=[];return t.forEach(function(e){var t=jQuery(e),n=window.innerHeight*window.innerWidth;if(function(e){if(!e)return!1;"function"==typeof jQuery&&e instanceof jQuery&&(e=e[0]);if(!e)return!1;var t=e.getBoundingClientRect();return t.top+t.height>=0&&t.left>=0&&t.bottom-t.height<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}(e)&&t.is(":visible")){var i=getComputedStyle(e);(t.height()*t.width()<.2*n&&t.position().top>10&&t.width()<.8*window.innerWidth&&e.clientHeight<window.innerHeight||"0px"===i.right&&"0px"===i.top&&t.height()===window.innerHeight&&t.width()<.3*window.innerWidth||"0px"===i.bottom&&"0px"!==i.top&&e.clientHeight<window.innerHeight||"0px"===i.top&&"100%"!==i.height&&e.clientHeight<window.innerHeight||t.height()<100&&t.width()<100&&t.height()*t.width()<5625&&e.clientHeight<window.innerHeight||"fixed"===i.position&&i.top.replace("px","").includes("-")||"fixed"===i.position&&"0px"===i.top&&"100%"!==i.height&&e.clientHeight>window.innerHeight||"fixed"===i.position&&"0px"==i.left&&"0px"===i.bottom&&"100%"!==i.height&&e.clientHeight<window.innerHeight&&("100%"===i.width||e.clientWidth==window.innerWidth)||"fixed"===i.position&&"0px"==i.top&&"0px"==i.right&&i.height.replace("px","")==e.clientHeight&&e.clientHeight==window.innerHeight)&&d.push(e)}}),d}function getAnnoyingElements(){for(var e=document.getElementsByTagName("*"),t=[],n=0;n<e.length;n++){var i=e[n],o=getComputedStyle(i),l=o.position;"0"!==o.width&&"0"!==o.height&&"0"!==o.opacity&&"none"!==o.display&&"hidden"!==o.visibility&&(l.includes("fixed")||l.includes("sticky"))&&t.push(i)}var d=[];return t.forEach(function(e){var t=jQuery(e),n=window.innerHeight*window.innerWidth;if(function(e){if(!e)return!1;"function"==typeof jQuery&&e instanceof jQuery&&(e=e[0]);if(!e)return!1;var t=e.getBoundingClientRect();return t.top+t.height>=0&&t.left>=0&&t.bottom-t.height<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}(e)&&t.is(":visible")){var i=getComputedStyle(e);(t.height()*t.width()<.2*n&&t.position().top>10&&t.width()<.8*window.innerWidth&&e.clientHeight<window.innerHeight||"0px"===i.right&&"0px"===i.top&&t.height()===window.innerHeight&&t.width()<.3*window.innerWidth||"0px"===i.bottom&&"0px"!==i.top&&$("body").width()===t.width()&&t.height()<.3*window.innerHeight||t.height()<100&&t.width()<100&&t.height()*t.width()<5625&&e.clientHeight<window.innerHeight||"fixed"===i.position&&i.top.replace("px","").includes("-")||"fixed"===i.position&&"0px"===i.top&&"100%"!==i.height&&e.clientHeight>window.innerHeight||"fixed"===i.position&&"0px"==i.left&&"0px"===i.bottom&&"100%"!==i.height&&e.clientHeight<window.innerHeight&&("100%"===i.width||e.clientWidth==window.innerWidth)||"fixed"===i.position&&"0px"==i.top&&"0px"==i.right&&i.height.replace("px","")==e.clientHeight&&e.clientHeight==window.innerHeight)&&d.push(e)}}),d}chrome.storage.sync.get(["captureDelay","useDelay"],function(e){(CAPTURE_DELAY=void 0===e.useDelay||!0===e.useDelay?void 0===e.captureDelay?500:1e3*e.captureDelay:500)<500&&(CAPTURE_DELAY=500)}),window.hasScreenCapturePage||(window.hasScreenCapturePage=!0,chrome.runtime.onMessage.addListener(onMessage));