function DOMtoString(){var t=document.getElementsByTagName("img"),e=document.getElementsByTagName("video"),r=[],i=[],n=$("a");location.href.indexOf("huaban.com")>-1?i=jQuery(".pin"):location.href.indexOf("pinterest.com")>-1&&(i=jQuery("[data-grid-item]"));for(var a=0;a<t.length;a++){if(!((m=t[a]).width<5||m.height<5)){var s,c=getHighestResImg(m)||m.src,o=m.naturalWidth,g=m.naturalHeight,l=!1;if(m.hasAttribute("srcset")&&(l=!0),c&&-1===c.indexOf("data:image")&&/\S+[.]pinimg[.]com/.test(c)&&"string"==typeof m.srcset){var u=m.srcset.split(","),h=u[u.length-1].replace(/[0-9]+x/g,"").trim();/\S+[.]pinimg[.]com/.test(h)&&(c=h,l=!0)}if(location.href.indexOf("huaban.com")>-1){if((d=i.has(m)).length>0)(f=d.find("p.description").attr("data-formatted"))&&f.length>0&&(s=f.trim())}else if(location.href.indexOf("pinterest.com")>-1){var d,f;if((d=i.has(m)).length>0)(f=d.find("[data-force-refresh]").text())&&f.length>0&&(s=f.trim())}var m,p=n.has(m),v="";p.length>0&&(v=p[0].href),v!==(m={type:"image",width:o,height:g,src:c,title:s||getBestTitle(m)}).src&&(v.startsWith("http")||v.startsWith("file:")||v.startsWith("/"))&&(m.url=v),l&&(m.urlConverted=!0),r.push(m)}}for(var y=0;y<e.length;y++){o=(w=e[y]).videoWidth,g=w.videoHeight;if(w.duration)if(w.currentSrc&&(c=w.currentSrc),c.toLowerCase().indexOf(".mp4")>-1||c.toLowerCase().indexOf(".webm")>-1){var w={type:"video",width:o,height:g,duration:w.duration,src:c,title:getBestTitle(w)};r.push(w)}}return getBackgroundImages().forEach(function(t){r.push(t)}),r=r.filter(function(t){return""!==t.src})}function getStyle(t,e){if(t.currentStyle)var r=t.currentStyle[e];else if(window.getComputedStyle)r=document.defaultView.getComputedStyle(t,null).getPropertyValue(e);return r}function getBackgroundImages(){var t,e=document.getElementsByTagName("*"),r=[],i=0;for(i=1;i<e.length;i++)if((t=getStyle(e[i],"background-image"))&&"none"!==t&&-1===t.indexOf("gradient")){t&&-1===t.indexOf("data:image")&&(t=t.replace(/url\((['"])?(.*?)\1\)/gi,"$2"));var n=new Image;n.src=t;var a=n.width,s=n.height;if(a<5||s<5)continue;var c="";try{t&&(c=decodeURIComponent(t).split("/").pop().replace(/\.[^.]*$/,""))}catch(t){}r.push({type:"image",title:e[i].alt||e[i].title||c,width:a,height:s,src:t})}return r}function getBestTitle(t){var e=t&&(t.customTitle||t.title)||t&&t.alt;try{e=e&&e.trim();var r=t.currentSrc||t.src||getHighestResImg(t);if(r=r.split("?")[0],!e&&r&&r.indexOf(".")>-1)try{if((e=decodeURIComponent(r).split("/").pop().replace(/\.[^.]*$/,""))&&null===e.match(/[^a-zA-Z0-9 -_]/g)){var i=e.split(/\d+/).length;1===e.split(" ").length&&i>2&&(e=document.title)}}catch(t){}return("图片"===e||e.indexOf("https://")>-1)&&(e=void 0),e&&e!=parseInt(e)||(e=document.title),e}catch(t){return e}}function getHighestResImg(t){const e=/^-?\d+$/;let r=t.currentSrc||t.getAttribute("src");if(t.getAttribute("srcset")&&t.currentSrc&&-1===t.currentSrc.indexOf("pximg")){var i=t.getAttribute("srcset"),n=(a=i.split(/,+/).map(t=>{const r={};return t.trim().split(/\s+/).forEach((t,i)=>{if(0===i)return void(r.url=t);const n=t.slice(0,-1),a=t[t.length-1],s=Number.parseInt(n,10);Number.parseFloat(n);"w"===a&&e.test(n)?s>0&&(r.width=s):"x"===a&&e.test(n)&&s>0&&(r.width=s)}),r})).sort().filter((t,e)=>JSON.stringify(t)!==JSON.stringify(a[e-1]));return(n=n.sort(function(t,e){return t.width>e.width?-1:t.width<e.width?1:0})).length>0&&n[0]&&n[0].width>0&&n[0].url?n[0].url:r}return r;var a}chrome.runtime.sendMessage({action:"getSource",source:JSON.stringify(DOMtoString())});