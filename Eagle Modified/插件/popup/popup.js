var isFirefox=navigator.userAgent.indexOf("Firefox")>-1,i18n={default:{dropdown:{"save-board":"Save Board's images","save-url":"Save URL to Eagle","save-images":"Batch save","save-bookmark":"Save as Bookmark","capture-selected":"Capture Area","capture-visible":"Capture Visible","capture-entire":"Capture Page",capturing:"Capturing page...","capture-almost-done":"Alomost there...","capture-entire-beta":"Capture Entire Page (Beta)","never-drag-url":"Disable drag on this URL","never-drag-domain":"Disable drag on this Domain",enable:'<span class="state-enable">Enabled</span> on this site',disable:'<span class="state-disable">Disabled</span> on this site',shortcuts:"Shortcuts Settings"},settings:{title:"Preferences",back:"Back","drag-feature":"Drag behavior","drag-cursor":"Mouse Direction","drag-bottom":"Bottom","drag-disable":"Disable","format-feature":"Screenshot Format","collect-setting":"Collect Settings","using-collect":"Ask where to save when saving images","screenshot-setting":"Screenshot Settings","using-retina":"Apply Retina Display resolution (2x) when available","scroll-delay":"Scroll delay:","scroll-delay-sec":"sec.",shortcuts:"Shortcuts","shortcuts-btn":"Configure shortcuts","shortcuts-placeholder":"enter a shortcut ","shortcuts-save-url":"Save URL","shortcuts-save-images":"Batch save","shortcuts-capture-selected":"Capture Area","shortcuts-capture-visible":"Capture Visible","shortcuts-capture-entire":"Capture Page"},error:{"not-open-app":"Please open Eagle app first."}},de:{dropdown:{"save-board":"Save Board's images","save-url":"URL in Eagle speichern","save-images":"Stapelweise speichern","save-bookmark":"Als Lesezeichen speichern","capture-selected":"Bereich aufzeichnen","capture-visible":"Sichtbares aufzeichnen","capture-entire":"Seite aufzeichnen",capturing:"Seite wird aufgezeichnet...","capture-almost-done":"Fast geschafft......","capture-entire-beta":"Capture Entire Page (Beta)","never-drag-url":"Drag in dieser URL deaktivieren","never-drag-domain":"Drag in dieser Domäne deaktivieren",enable:'<span class="state-enable">Enabled</span> auf dieser Website',disable:'<span class="state-disable">Disabled</span> auf dieser Webseite',shortcuts:"Verknüpfungseinstellungen","new-version":"Neue Version ist erreichbar:"},settings:{title:"Voreinstellungen",back:"Zurück","drag-feature":"Drag-Verhalten","drag-cursor":"Mausrichtung","drag-bottom":"Unten","drag-disable":"Deaktivieren","format-feature":"Screenshot-Format","collect-setting":"Sammeln-Einstellungen","using-collect":"Mich fragen, wo die Bilder gespeichert werden","screenshot-setting":"Screenshot-Einstellungen","using-retina":"Retina Display-Auflösung (2x) anwenden, wenn verfügbar","scroll-delay":"Bildlaufverzögerung:","scroll-delay-sec":"sek.",shortcuts:"Verknüpfungen","shortcuts-btn":"Verknüpfungen konfigurieren","shortcuts-placeholder":"Verknüpfung eingeben","shortcuts-save-url":"URL speichern","shortcuts-save-images":"Stapelweise speichern","shortcuts-capture-selected":"Bereich aufzeichnen","shortcuts-capture-visible":"Sichtbares aufzeichnen","shortcuts-capture-entire":"Seite aufzeichnen"},error:{"not-open-app":"Bitte zuerst Eagle App öffnen."}},es:{dropdown:{"save-board":"Guardar las imágenes del tablero","save-url":"Guardar URL a Eagle","save-images":"Guardar a lote","save-bookmark":"Guardar en Marcador","capture-selected":"Capturar selección","capture-visible":"Capturar visible","capture-entire":"Capturar la página",capturing:"Capturando...","capture-almost-done":"Casi acabado...","capture-entire-beta":"Capturar entera pantalla (Beta) ","never-drag-url":"Se arrastra en esta URL","never-drag-domain":"Se arrastra en este Dominio",enable:'<span class="state-enable">Activar</span> en este sitio',disable:'<span class="state-enable">Desactivar</span> en este sitio',shortcuts:"Preferencias de atajos","new-version":"Está disponible la nueva versión:"},settings:{title:"Preferencias",back:"Volver","drag-feature":"Comportamiento Arrastrar","drag-cursor":"Dirección de ratón","drag-bottom":"Debajo","drag-disable":"Desactivar","format-feature":"Formato de captura de pantalla","collect-setting":"Preferencias de colección","using-collect":"Pregúntame dónde al guardar imágenes ","screenshot-setting":"Preferencias de captura","using-retina":"Capturar en calidad Retina (2x) cuando disponible","scroll-delay":"Retraso de desplazamiento:","scroll-delay-sec":"segundo.",shortcuts:"Atajos","shortcuts-btn":"Configuración de atajos","shortcuts-placeholder":"Introducir tecla de atajos ","shortcuts-save-url":"Guardar URL ","shortcuts-save-images":"Guardar a lote","shortcuts-capture-selected":"Capturar selección","shortcuts-capture-visible":"Capturar visible","shortcuts-capture-entire":"Capturar la página"},error:{"not-open-app":"Por favor abre primero Eagle."}},ru:{dropdown:{"save-board":"Сохранить изображения платы","save-url":"Сохранить ссылку","save-images":"Сохранить группой","save-bookmark":"Сохранить все изображения","capture-selected":"Снимок выбранной области","capture-visible":"Снимок видимой части страницы","capture-entire":"Снимок всей страницы",capturing:"Скриншот...","capture-almost-done":"Почти получилось...","capture-entire-beta":"Capturar entera pantalla (Beta) ","never-drag-url":"Не сохранять на этой странице","never-drag-domain":"Не сохранять на всём домене",enable:'<span class="state-enable">Включено</span> on this site',disable:'<span class="state-disable">Отключено</span> on this site',shortcuts:"Настройка сочетаний клавиш","new-version":"Доступна новая версия:"},settings:{title:"Настройки",back:"Назад","drag-feature":"Положение области сохранения","drag-cursor":"Возле мыши","drag-bottom":"Внизу","drag-disable":"Выключить","format-feature":"Формат снимка экрана","collect-setting":"Опция сохранения","using-collect":"Спрашивать куда сохранять снимок экрана ","screenshot-setting":"Настройка скриншота","using-retina":"Снимать изображения в разрешении Retina (2x), если есть возможность","scroll-delay":"Задержка прокрутки:","scroll-delay-sec":"сек",shortcuts:"Горячие клавиши","shortcuts-btn":"Настройка сочетаний клавиш","shortcuts-placeholder":"Введите сочетание клавиш","shortcuts-save-url":"Сохранить ссылку","shortcuts-save-images":"Сохранить все изображения","shortcuts-capture-selected":"Снимок выбранной области","shortcuts-capture-visible":"Снимок видимой части страницы","shortcuts-capture-entire":"Снимок всей страницы"},error:{"not-open-app":"Пожалуйста, сначала откройте приложение Eagle"}},ko:{dropdown:{"save-board":"보드 이미지 저장","save-url":"Eagle에 URL 저장하기","save-images":"일괄저장","save-bookmark":"북마크로 저장하기","capture-selected":"선택 범위 캡처","capture-visible":"보이는 범위 캡처","capture-entire":"웹페이지 전체 캡처",capturing:"캡처 중입니다...","capture-almost-done":"Alomost there...","capture-entire-beta":"Capture Entire Page (Beta)","never-drag-url":"URL을 드래그 기능 비활성화","never-drag-domain":"도메인 드래그 기능 비활성화",enable:'<span class="state-enable">Enabled</span> on this site',disable:'<span class="state-disable">Disabled</span> on this site',shortcuts:"바로 가기 키 설정하기"},settings:{title:"설정",back:"뒤로 가기","drag-feature":"드래그 저장방식 설정","drag-cursor":"화면 아래쪽으로","drag-bottom":"드래그 방향으로","drag-disable":"비활성화","format-feature":"스크린샷 포맷","collect-setting":"저장 설정","using-collect":"저장 시 이미지 분류 창이 나타나게 하기","screenshot-setting":"스크린샷 설정","using-retina":"기기에서 지원이 가능하다면, Retina를 사용해 이미지 캡처","scroll-delay":"스크롤 지연:","scroll-delay-sec":"초",shortcuts:"바로 가기 키 설정하기","shortcuts-btn":"바로 가기 키 설정 메뉴 켜기","shortcuts-placeholder":"바로 가기 키 입력하기","shortcuts-save-url":"북마크 저장하기","shortcuts-save-images":"일괄저장","shortcuts-capture-selected":"선택 범위 캡처","shortcuts-capture-visible":"보이는 범위 캡처","shortcuts-capture-entire":"웹페이지 전체 캡처"},error:{"not-open-app":"먼저 Eagle 응용프로그램을 실행해 주시기 바랍니다."}},ja:{dropdown:{"save-board":"ボードの画像を保存する","save-url":"URL を Eagle に保存","save-images":"バッチ保存","save-bookmark":"Save as Bookmark","capture-selected":"エリアをスクショ","capture-visible":"ビジブルエリアをスクショ","capture-entire":"ページ全体をスクショ",capturing:"Capturing page...","capture-almost-done":"Alomost there...","capture-entire-beta":"Capture Entire Page (Beta)","never-drag-url":"このURLに無効にドラッグ","never-drag-domain":"このドメイン上の無効ドラッグ",enable:'<span class="state-enable">Enabled</span> on this site',disable:'<span class="state-disable">Disabled</span> on this site',shortcuts:"Shortcuts Settings"},settings:{title:"設定",back:"戻る","drag-feature":"ドラッグを設定","drag-cursor":"ドラッグした方向で現る","drag-bottom":"ウインドウ底で現る","drag-disable":"無効化","format-feature":"ファイルフォーマット","collect-setting":"保存設定","using-collect":"画像を保存する同時に編集ウインドウで分類","screenshot-setting":"スクリーンショットを設定","using-retina":"Retina ディスプレイで高解像度スクショをする","scroll-delay":"スクロールの遅延:","scroll-delay-sec":"秒",shortcuts:"ショートカット機能","shortcuts-btn":"ショートカットキーを設定","shortcuts-placeholder":"ショートカットキーを入力","shortcuts-save-url":"URLを保存","shortcuts-save-images":"バッチ保存","shortcuts-capture-selected":"エリアをスクショ","shortcuts-capture-visible":"ビジブルエリアをスクショ","shortcuts-capture-entire":"ページ全体をスクショ"},error:{"not-open-app":"Please open Eagle app first."}},"zh-TW":{dropdown:{"save-board":"收藏畫板圖片","save-url":"收藏為書籤","save-images":"批次收藏","save-bookmark":"收藏為書籤","capture-selected":"區域截圖","capture-visible":"可視範圍截圖","capture-entire":"整頁截圖",capturing:"正在進行截圖...","capture-almost-done":"即將完成...","capture-entire-beta":"整頁截圖 (Beta)","never-drag-url":"在此網址禁用拖曳功能","never-drag-domain":"在此網域禁用拖曳功能",enable:'拖曳儲存功能「<span class="state-enable">啟用</span>」',disable:'拖曳儲存功能「<span class="state-disable">禁用</span>」',shortcuts:"快速鍵設定"},settings:{title:"偏好設定",back:"返回","drag-feature":"拖曳收藏","drag-cursor":"拖曳方向","drag-bottom":"視窗下方","drag-disable":"關閉","format-feature":"截圖格式","collect-setting":"收藏設定","using-collect":"收藏圖片時，顯示編輯視窗進行分類","screenshot-setting":"截圖設定","using-retina":"如果裝置支援，使用 Retina 進行截圖","scroll-delay":"捲動截圖延遲","scroll-delay-sec":"秒","capture-delay":"延遲",shortcuts:"快速鍵設定","shortcuts-btn":"開啟快速鍵設定頁面","shortcuts-placeholder":"輸入快速鍵","shortcuts-save-url":"收藏書籤","shortcuts-save-images":"批次收藏","shortcuts-capture-selected":"選擇區域截圖","shortcuts-capture-visible":"可視區域截圖","shortcuts-capture-entire":"整張網頁截圖"},error:{"not-open-app":"請先開啟 Eagle 應用程式"}},"zh-CN":{dropdown:{"save-board":"保存画板图片","save-url":"保存为书签","save-images":"批量收藏","save-bookmark":"收藏为书签","capture-selected":"区域截图","capture-visible":"可视范围截图","capture-entire":"整页截图",capturing:"正在进行截图...","capture-almost-done":"即将完成...","capture-entire-beta":"整页截图 (Beta)","never-drag-url":"在此页面禁用拖拽","never-drag-domain":"在此域名禁用拖拽",enable:'拖拽保存功能「<span class="state-enable">启用</span>」',disable:'拖拽保存功能「<span class="state-disable">禁用</span>」',shortcuts:"快捷键设置"},settings:{title:"偏好设置",back:"返回","drag-feature":"拖拽保存","drag-cursor":"拖拽方向","drag-bottom":"窗口底部","drag-disable":"关闭","format-feature":"截图格式","collect-setting":"收藏设置","using-collect":"保存图片时，显示编辑窗口进行分类","screenshot-setting":"截图设置","using-retina":"如果设备支持，使用 Retina 画质进行截图","scroll-delay":"滚动截图延迟","scroll-delay-sec":"秒","capture-delay":"延遲",shortcuts:"快捷键设置","shortcuts-btn":"打开快捷键设置页面","shortcuts-placeholder":"输入快捷键","shortcuts-save-url":"收藏书签","shortcuts-save-images":"批量收藏","shortcuts-capture-selected":"选择区域截图","shortcuts-capture-visible":"可视区域截图","shortcuts-capture-entire":"整张网页截图"},error:{"not-open-app":"请先开启 Eagle 应用程式"}}},i18n_words=i18n.default,languageMap={zh:"zh-CN",es:"es",de:"de",ru:"ru",ja:"ja",ko:"ko",en:"en"},language=window.navigator.language.toLowerCase(),languageKey=language.split("-")[0],i18nKey=languageMap[languageKey];"zh-tw"===language?i18n_words=i18n["zh-TW"]:i18n[i18nKey]&&(i18n_words=i18n[i18nKey]),window.jQuery("body").addClass(language);var appVersion,buildVersion,showCollectModal,shortcutsSettings,metas={metaTags:"",metaTitle:"",metaDescription:"",metaKeywords:""};function initShortcuts(){chrome.storage.sync.get(["shortcutsSettings"],function(e){if(void 0===e.shortcutsSettings)shortcutsSettings={macOS:{"url-save":"Alt + 0","batch-save":"Alt + 1","capture-area":"Alt + 2","capture-visible":"Alt + 3","capture-entire":"Alt + 4"},Windows:{"url-save":"Alt + 0","batch-save":"Alt + 1","capture-area":"Alt + 2","capture-visible":"Alt + 3","capture-entire":"Alt + 4"}};else try{shortcutsSettings=JSON.parse(e.shortcutsSettings)}catch(e){shortcutsSettings={macOS:{"url-save":"Alt + 0","batch-save":"Alt + 1","capture-area":"Alt + 2","capture-visible":"Alt + 3","capture-entire":"Alt + 4"},Windows:{"url-save":"Alt + 0","batch-save":"Alt + 1","capture-area":"Alt + 2","capture-visible":"Alt + 3","capture-entire":"Alt + 4"}}}navigator.platform.toUpperCase().indexOf("MAC")>=0?(window.jQuery("#url-save-shortcut").val(shortcutsSettings.macOS["url-save"]),window.jQuery("#batch-save-shortcut").val(shortcutsSettings.macOS["batch-save"]),window.jQuery("#capture-area-shortcut").val(shortcutsSettings.macOS["capture-area"]),window.jQuery("#capture-visible-shortcut").val(shortcutsSettings.macOS["capture-visible"]),window.jQuery("#capture-entire-shortcut").val(shortcutsSettings.macOS["capture-entire"]),window.jQuery("#save-url .shortcut").text(shortcutsSettings.macOS["url-save"].replace("Shift","⇧").replace("Ctrl","⌃").replace("Command","⌘").replace("Alt","⌥").replace(/\+/g," ")),window.jQuery("#save-images .shortcut").text(shortcutsSettings.macOS["batch-save"].replace("Shift","⇧").replace("Ctrl","⌃").replace("Command","⌘").replace("Alt","⌥").replace(/\+/g," ")),window.jQuery("#capture-selected .shortcut").text(shortcutsSettings.macOS["capture-area"].replace("Shift","⇧").replace("Ctrl","⌃").replace("Command","⌘").replace("Alt","⌥").replace(/\+/g," ")),window.jQuery("#capture-visible .shortcut").text(shortcutsSettings.macOS["capture-visible"].replace("Shift","⇧").replace("Ctrl","⌃").replace("Command","⌘").replace("Alt","⌥").replace(/\+/g," ")),window.jQuery("#capture-entire .shortcut").text(shortcutsSettings.macOS["capture-entire"].replace("Shift","⇧").replace("Ctrl","⌃").replace("Command","⌘").replace("Alt","⌥").replace(/\+/g," "))):(window.jQuery("#url-save-shortcut").val(shortcutsSettings.Windows["url-save"]),window.jQuery("#batch-save-shortcut").val(shortcutsSettings.Windows["batch-save"]),window.jQuery("#capture-area-shortcut").val(shortcutsSettings.Windows["capture-area"]),window.jQuery("#capture-visible-shortcut").val(shortcutsSettings.Windows["capture-visible"]),window.jQuery("#capture-entire-shortcut").val(shortcutsSettings.Windows["capture-entire"]),window.jQuery("#save-url .shortcut").text(shortcutsSettings.Windows["url-save"]),window.jQuery("#save-images .shortcut").text(shortcutsSettings.Windows["batch-save"]),window.jQuery("#capture-selected .shortcut").text(shortcutsSettings.Windows["capture-area"]),window.jQuery("#capture-visible .shortcut").text(shortcutsSettings.Windows["capture-visible"]),window.jQuery("#capture-entire .shortcut").text(shortcutsSettings.Windows["capture-entire"]))})}initShortcuts();var dragEnable=!0,urlBlackList=[],domainBlackList=[],useDelay=!0,captureDelay=.5,captureFormat="png",dragMode=parseInt(localStorage.getItem("dragMode"))||1;chrome.storage.sync.get(["dragMode"],function(e){switch(void 0===e.dragMode?(dragMode=1,dragEnable=!0):(dragMode=e.dragMode,dragEnable=0!==e.dragMode),window.jQuery(".drag-feature").removeClass("active"),dragMode){case 0:window.jQuery("#drag-disable").addClass("active");break;case 1:window.jQuery("#drag-cursor").addClass("active");break;case 2:window.jQuery("#drag-bottom").addClass("active")}}),chrome.storage.sync.get(["captureDelay","useDelay"],function(e){useDelay=void 0===e.useDelay||e.useDelay,captureDelay=void 0===e.captureDelay?.5:e.captureDelay,useDelay&&(window.jQuery("#capture-delay-checkbox")[0].checked=!0),window.jQuery("#capture-delay").val(captureDelay)}),captureFormat=localStorage.getItem("captureFormat")||"png",chrome.storage.sync.get(["captureFormat"],function(e){captureFormat=void 0===e.captureFormat?"png":e.captureFormat,window.jQuery(".format-feature").removeClass("active"),"png"===captureFormat?window.jQuery("#format-png").addClass("active"):window.jQuery("#format-jpeg").addClass("active")}),document.addEventListener("DOMContentLoaded",function(){chrome.tabs;window.jQuery("#save-board .name").text(i18n_words.dropdown["save-board"]),window.jQuery("#save-url .name").text(i18n_words.dropdown["save-url"]),window.jQuery("#save-images .name").text(i18n_words.dropdown["save-images"]),window.jQuery("#save-bookmark .name").text(i18n_words.dropdown["save-bookmark"]),window.jQuery("#capture-selected .name").text(i18n_words.dropdown["capture-selected"]),window.jQuery("#capture-visible .name").text(i18n_words.dropdown["capture-visible"]),window.jQuery("#capture-entire .name").text(i18n_words.dropdown["capture-entire"]),window.jQuery("#capture-entire-beta .name").text(i18n_words.dropdown["capture-entire-beta"]),window.jQuery("#not-open-app p").text(i18n_words.error["not-open-app"]),window.jQuery("#disable-drag-url .name").text(i18n_words.dropdown["never-drag-url"]),window.jQuery("#disable-drag-domain .name").text(i18n_words.dropdown["never-drag-domain"]),window.jQuery("#preferences .name").html(i18n_words.settings.title),window.jQuery("#settings-menu .settings-header .title").html(i18n_words.settings.title),window.jQuery("#settings-menu .settings-header #back").html(i18n_words.settings.back),window.jQuery("#settings-menu #drag-feature .label").html(i18n_words.settings["drag-feature"]),window.jQuery("#settings-menu #drag-feature #drag-cursor .name").html(i18n_words.settings["drag-cursor"]),window.jQuery("#settings-menu #drag-feature #drag-bottom .name").html(i18n_words.settings["drag-bottom"]),window.jQuery("#settings-menu #drag-feature #drag-disable .name").html(i18n_words.settings["drag-disable"]),window.jQuery("#settings-menu #format-feature .label").html(i18n_words.settings["format-feature"]),window.jQuery("#settings-menu #collect-feature .label").html(i18n_words.settings["collect-setting"]),window.jQuery("#settings-menu #retina-feature .label").html(i18n_words.settings["screenshot-setting"]),window.jQuery("#settings-menu #collect-feature label").html(i18n_words.settings["using-collect"]),window.jQuery("#settings-menu #retina-feature label").html(i18n_words.settings["using-retina"]),window.jQuery("#capture-delay-label").html(i18n_words.settings["scroll-delay"]),window.jQuery("#capture-delay-sec").html(i18n_words.settings["scroll-delay-sec"]),window.jQuery("#settings-menu #shortcuts-feature .label").html(i18n_words.settings.shortcuts),window.jQuery("#settings-menu #shortcuts-feature .btn").html(i18n_words.settings["shortcuts-btn"]),window.jQuery("#settings-menu #shortcuts-feature input").attr("placeholder",i18n_words.settings["shortcuts-placeholder"]),window.jQuery("#settings-menu #shortcuts-feature .url").html(i18n_words.settings["shortcuts-save-url"]),window.jQuery("#settings-menu #shortcuts-feature .batch").html(i18n_words.settings["shortcuts-save-images"]),window.jQuery("#settings-menu #shortcuts-feature .selected").html(i18n_words.settings["shortcuts-capture-selected"]),window.jQuery("#settings-menu #shortcuts-feature .visible").html(i18n_words.settings["shortcuts-capture-visible"]),window.jQuery("#settings-menu #shortcuts-feature .entire").html(i18n_words.settings["shortcuts-capture-entire"]),window.jQuery("#retina-feature .name.capture-delay").html(i18n_words.settings["capture-delay"]),window.jQuery("#retina-support")[0].checked="true"===localStorage.getItem("useRetina"),chrome.storage.sync.get(["urlBlackList","domainBlackList"],function(e){urlBlackList=e.urlBlackList||[],domainBlackList=e.domainBlackList||[],chrome.tabs.query({active:!0,currentWindow:!0},function(e){var t=e[0].url;o(t,new URL(t).hostname)})});var e=navigator.platform.toUpperCase().indexOf("MAC")>=0;function t(e){localStorage.setItem("captureFormat",e),chrome.storage.sync.set({captureFormat:e}),chrome.runtime.sendMessage({action:"change-capture-format",format:e}),chrome.runtime.sendMessage({action:"update-config"})}function a(e){chrome.tabs.query({},function(t){for(var a=0;a<t.length;++a)chrome.tabs.sendMessage(t[a].id,{action:"drag-mode-"+e},function(){chrome.runtime.lastError&&console.log(chrome.runtime.lastError)})}),localStorage.setItem("dragMode",e),chrome.storage.sync.set({dragMode:e}),chrome.runtime.sendMessage({action:"update-config"})}function r(e,t){localStorage.setItem("useDelay",e),localStorage.setItem("captureDelay",t),chrome.runtime.sendMessage({action:"change-capture-dealy",useDelay:e}),chrome.storage.sync.set({useDelay:e,captureDelay:t}),chrome.runtime.sendMessage({action:"update-config"})}e&&window.jQuery(".menu-item .shortcut").each(function(){var e=$(this).text();$(this).text(e.replace("Ctrl","⌘").replace("Alt","⌥").replace(/\+/g," "))}),chrome.runtime.onMessage.addListener(function(e,t){return"extractSiteMetas"==e.action&&e.result&&(metas=e.result,window.jQuery.ajax({method:"GET",url:"http://localhost:41595/api/application/info",dataType:"json",data:{}}).always(function(e){if(0!==e.status){var t=e.data;t.buildVersion&&(buildVersion=parseInt(t.buildVersion))}})),!0}),window.jQuery("#save-images").on("click",function(){chrome.tabs.executeScript(null,{file:"/js/utils/getPagesSource.js"})}),window.jQuery(".save-url-btn").on("click",function(){chrome.runtime.sendMessage({action:"save-url",metas:metas}),setTimeout(function(){window.close()},100)}),chrome.tabs.query({active:!0,currentWindow:!0},function(e){var t=e[0].url;t.includes("huaban.com/boards")||t.includes("pinterest.")||t.includes("dribbble.com/")||t.includes("meiye.art/")?(window.jQuery(".save-board").show(),window.jQuery("body").addClass("save-board")):(window.jQuery(".save-board").hide(),window.jQuery("body").removeClass("save-board"))}),window.jQuery(".save-board").on("click",function(){chrome.runtime.sendMessage({action:"save-board",metas:metas}),setTimeout(function(){window.close()},100)}),window.jQuery("#url-save-shortcut").change(function(){e?shortcutsSettings.macOS["url-save"]=$(this).val():shortcutsSettings.Windows["url-save"]=$(this).val(),n()}),window.jQuery("#batch-save-shortcut").change(function(){e?shortcutsSettings.macOS["batch-save"]=$(this).val():shortcutsSettings.Windows["batch-save"]=$(this).val(),n()}),window.jQuery("#capture-area-shortcut").change(function(){e?shortcutsSettings.macOS["capture-area"]=$(this).val():shortcutsSettings.Windows["capture-area"]=$(this).val(),n()}),window.jQuery("#capture-visible-shortcut").change(function(){e?shortcutsSettings.macOS["capture-visible"]=$(this).val():shortcutsSettings.Windows["capture-visible"]=$(this).val(),n()}),window.jQuery("#capture-entire-shortcut").change(function(){e?shortcutsSettings.macOS["capture-entire"]=$(this).val():shortcutsSettings.Windows["capture-entire"]=$(this).val(),n()}),window.jQuery("#capture-delay-checkbox").on("change",function(){setTimeout(function(){let e=window.jQuery("#capture-delay-checkbox")[0].checked,t=1*window.jQuery("#capture-delay").val();t||(t=.1,window.jQuery("#capture-delay").val(.1)),r(e,t)},100)}),window.jQuery("#capture-delay").change(function(){r(window.jQuery("#capture-delay-checkbox")[0].checked,1*window.jQuery("#capture-delay").val())});var s,n=debounce(function(){chrome.storage.sync.set({shortcutsSettings:JSON.stringify(shortcutsSettings)},function(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){chrome.tabs.sendMessage(e[0].id,{action:"shortcuts-change"})})})},300,!0);function o(e,t){e&&(urlBlackList.indexOf(e)>-1?window.jQuery("#disable-drag-url .checkbox").prop("checked",!0):window.jQuery("#disable-drag-url .checkbox").prop("checked",!1)),t&&(domainBlackList.indexOf(t)>-1?window.jQuery("#disable-drag-domain .checkbox").prop("checked",!0):window.jQuery("#disable-drag-domain .checkbox").prop("checked",!1))}function i(){chrome.tabs.query({},function(e){for(var t=0;t<e.length;++t)chrome.tabs.sendMessage(e[t].id,{action:"update-drag-mode"},function(e){chrome.runtime.lastError&&console.log(chrome.runtime.lastError)})})}window.jQuery("body").on("keydown",".shortcut-input",function(t){t.preventDefault();var a=$(".shortcut-input").map(function(){return $(this).val()}).get(),r=t.keyCode,s=String.fromCharCode(r),n=t.shiftKey,o=t.metaKey,i=t.ctrlKey,c=t.altKey,u=!1,l="";switch(i&&(l+="Ctrl + ",u=!0),o&&e&&(l+="Command + ",u=!0),n&&(l+="Shift + ",u=!0),c&&(l+="Alt + ",u=!0),r){case 8:if(0==l.length)return l="",void $(this).val(l).trigger("change");break;case 112:l+="F1",u=!1;break;case 113:l+="F2",u=!1;break;case 114:l+="F3",u=!1;break;case 115:l+="F4",u=!1;break;case 117:l+="F6",u=!1;break;case 118:l+="F7",u=!1;break;case 119:l+="F8",u=!1;break;case 120:l+="F9",u=!1;break;case 121:l+="F10",u=!1;break;case 122:l+="F11",u=!1;break;case 123:l+="F12",u=!1;break;default:u&&(i||o||c||n)&&(187===r&&(l+="=",u=!1),107===r?(l+="Plus",u=!1):189===r||109===r?(l+="-",u=!1):/[^A-Za-z0-9-=+_.]/.test(s.toUpperCase())||(l+=s.toUpperCase(),u=!1))}if(l&&!u){if(a&&-1!==a.indexOf(l))return;window.jQuery(this).val(l).trigger("change")}}),window.jQuery("#capture-entire").on("click",function(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){chrome.tabs.sendMessage(e[0].id,{action:"start-screencapture"},function(e){}),setTimeout(function(){window.close()},100)})}),window.jQuery("#download-log").on("click",function(){chrome.tabs.create({url:chrome.runtime.getURL("logger/logger.html?download=1")})}),window.jQuery("#capture-visible").on("click",function(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){chrome.tabs.sendMessage(e[0].id,{action:"start-capture-visible"},function(e){}),setTimeout(function(){window.close()},100)})}),window.jQuery("#capture-entire-beta").on("click",function(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){window.jQuery.ajax({method:"POST",url:"http://localhost:41593",dataType:"json",data:{type:"capture-website",title:e[0].title.replace(/[@#$%^&*()<>:'"\/\\|?*]+/g,""),url:e[0].url,metaTags:metas.metaTags,metaTitle:metas.metaTitle,metaDescription:metas.metaDescription,metaKeywords:metas.metaKeywords}}).always(function(e){0==e.status?setTimeout(function(){window.jQuery("#not-open-app").removeClass("hide"),window.jQuery("#dropdown-menu").addClass("hide")},200):setTimeout(function(){window.close()},100)})})}),window.jQuery("#capture-selected").on("click",function(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){chrome.tabs.sendMessage(e[0].id,{action:"open-crop-area"},function(e){}),setTimeout(function(){window.close()},100)})}),window.jQuery("#preferences").on("click",function(){window.jQuery("body").addClass("expand")}),window.jQuery("#disable-drag-url").on("click",function(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){var t=e[0].url;urlBlackList.indexOf(t)>-1?function(e){var t=urlBlackList.indexOf(e);t>-1&&(urlBlackList.splice(t,1),chrome.storage.sync.set({urlBlackList:urlBlackList},function(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){i()})}))}(t):function(e){urlBlackList.push(e),urlBlackList=[...new Set(urlBlackList)],chrome.storage.sync.set({urlBlackList:urlBlackList},function(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){i()})})}(t),o(t,void 0)})}),window.jQuery("#disable-drag-domain").on("click",function(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){var t=e[0].url,a=new URL(t).hostname;domainBlackList.indexOf(a)>-1?function(e){var t=domainBlackList.indexOf(e);t>-1&&(domainBlackList.splice(t,1),chrome.storage.sync.set({domainBlackList:domainBlackList},function(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){i()})}))}(a):function(e){domainBlackList.push(e),domainBlackList=[...new Set(domainBlackList)],chrome.storage.sync.set({domainBlackList:domainBlackList},function(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){i()})})}(a),o(t,a)})}),window.jQuery("#back").on("click",function(){window.jQuery("body").removeClass("expand"),setTimeout(function(){window.jQuery("#shortcut-input").focus()},200)}),window.jQuery("#drag-cursor").on("click",function(){window.jQuery(".drag-feature").removeClass("active"),window.jQuery(this).addClass("active"),a(1)}),window.jQuery("#drag-bottom").on("click",function(){window.jQuery(".drag-feature").removeClass("active"),window.jQuery(this).addClass("active"),a(2)}),window.jQuery("#drag-disable").on("click",function(){window.jQuery(".drag-feature").removeClass("active"),window.jQuery(this).addClass("active"),a(0)}),window.jQuery("#format-jpeg").on("click",function(){window.jQuery(".format-feature").removeClass("active"),window.jQuery(this).addClass("active"),t("jpeg")}),window.jQuery("#format-png").on("click",function(){window.jQuery(".format-feature").removeClass("active"),window.jQuery(this).addClass("active"),t("png")}),isFirefox&&((s=navigator.userAgent.match(/Firefox\/([0-9]+)\./))?parseInt(s[1],10):0)<80&&window.jQuery("#retina-feature").hide(),window.jQuery("#retina-support").on("change",function(){setTimeout(function(){var e;e=window.jQuery("#retina-support")[0].checked,localStorage.setItem("useRetina",e),chrome.runtime.sendMessage({action:"change-retina",useRetina:e}),chrome.storage.sync.set({useRetina:e}),chrome.runtime.sendMessage({action:"update-config"})},100)}),window.jQuery("#collect-support").on("change",function(){setTimeout(function(){window.jQuery("#collect-support")[0].checked?window.jQuery.ajax({method:"GET",url:"http://localhost:41595/api/preferences/collect/on",dataType:"json"}).always(function(e){}):window.jQuery.ajax({method:"GET",url:"http://localhost:41595/api/preferences/collect/off",dataType:"json"}).always(function(e){})},100)}),window.jQuery("#shortcut-input").on("keydown",function(e){switch(e.keyCode){case 66:window.jQuery("#save-images").trigger("click");break;case 83:window.jQuery("#capture-selected").trigger("click");break;case 69:window.jQuery("#capture-entire").trigger("click")}}),window.jQuery.ajax({method:"POST",url:"http://localhost:41593",dataType:"json",data:{}}).always(function(e){0==e.status||(e.appVersion&&(appVersion=e.appVersion,showCollectModal=e.showCollectModal),appVersion?($("#collect-feature").show(),window.jQuery("#collect-support")[0].checked=showCollectModal):$("#collect-feature").hide(),$("#shortcut-input").focus(),setTimeout(function(){window.jQuery("#not-open-app").addClass("hide"),window.jQuery("#dropdown-menu").removeClass("hide")},200))})}),chrome.tabs.executeScript(null,{file:"/js/utils/extractSiteMetas.js"});